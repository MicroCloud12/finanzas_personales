{% extends 'base.html' %}
{% load static %}
{% load socialaccount %}

{% block content %}
<div class="container mx-auto mt-10 p-5">
    <h1 class="text-3xl font-bold mb-6 text-gray-800">Procesamiento Automático de Tickets</h1>
    
    <div class="bg-white p-8 rounded-lg shadow-md border border-gray-200">
        <h2 class="text-xl font-semibold mb-4">Paso 1: Conecta tu cuenta de Google Drive</h2>
        <p class="text-gray-600 mb-5">
            Para poder leer los tickets y facturas, primero necesitamos que nos des permiso para acceder a los archivos de tu Google Drive. Tu información está segura y solo leeremos las imágenes.
        </p>
        
        {% if not user.socialaccount_set.all %}
            <a href="{% provider_login_url 'google' auth_params='access_type=offline&prompt=consent' %}" class="inline-block bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded shadow-lg">
                <i class="fab fa-google mr-2"></i> Conectar con Google Drive
            </a>
        {% else %}
            <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded" role="alert">
                <p class="font-bold">¡Conectado!</p>
                <p>Tu cuenta de Google Drive ya está vinculada. Ahora puedes iniciar la sincronización.</p>
            </div>
        {% endif %}

        <hr class="my-8">

        <h2 class="text-xl font-semibold mb-4">Paso 2: Iniciar la Sincronización</h2>
        <p class="text-gray-600 mb-5">
            Haz clic en el botón de abajo para buscar y procesar nuevos tickets en tu Google Drive. Esto puede tardar unos minutos.
        </p>

        {% if user.socialaccount_set.all %}
            <a href="{% url 'procesar_drive' %}" class="inline-block bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded shadow-lg">
                Sincronizar Tickets de Drive
            </a>
        {% else %}
            <button class="bg-gray-400 text-white font-bold py-2 px-4 rounded cursor-not-allowed" disabled>
                Sincronizar Tickets de Drive
            </button>
            <p class="text-sm text-gray-500 mt-2">Debes conectar tu cuenta de Google primero.</p>
        {% endif %}
    </div>
</div>
{% endblock %}